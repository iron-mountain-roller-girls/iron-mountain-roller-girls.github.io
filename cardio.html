<?php
require_once 'includes/config.php';

$mysqli = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

/*
 * This is the "official" OO way to do it,
 * BUT $connect_error was broken until PHP 5.2.9 and 5.3.0.
 */
if ($mysqli->connect_error) {
    die('Connect Error (' . $mysqli->connect_errno . ') '
        . $mysqli->connect_error);
}

if (!empty($_POST)) {
    $stmt =  $mysqli->stmt_init();
    $stmt->prepare("
        INSERT INTO `log`
        SET
          `people_id` = ?,
          `date` = ?,
          `time` = ?,
          `location` = ?,
          `activity` = ?,
          `length` = ?,
          `submitted` = NOW()
    ");
    $stmt->bind_param("isssss", $_POST['people_id'], $_POST['date'], $_POST['time'], $_POST['location'], $_POST['activity'], $_POST['length']);
    $stmt->execute();
    $stmt->close();

    header('Location: cardio.php?message=Your entry has been submitted.');
    exit;
    exit;
}


$query = "SELECT * FROM people ORDER BY `name` ASC";
$people = array();

if ($result = $mysqli->query($query)) {

    /* fetch associative array */
    while ($row = $result->fetch_assoc()) {
        $people[$row['id']] = $row['name'];
    }

    /* free result set */
    $result->free();
}

require_once 'includes/header.php';
?>
<div class="section page_header" style="padding:20px 40px">
    <h1> Requirements </h1>
</div>
<div class="content_section">
    <div class="row masonry_section">
        <div class="scgrid-12 masonry_handle">

            <div class="light_box">
                <h2>Log your Cardio</h2>

                <?php if (!empty($_REQUEST['message'])): ?>
                    <div class="notification warning">
                        <p><?php echo $_REQUEST['message']; ?></p>
                    </div>
                <?php endif; ?>

                <br>
                <div class="form">
                    <form action="cardio.php" method="post">
                        <div class="row" >
                            <div class="scgrid-6" >
                                <p>Name:</p>
                                <select class="form_input" name="people_id">
                                    <option vaue=""></option>
                                    <?php foreach ($people as $id => $name): ?>
                                        <option value="<?php echo $id; ?>"><?php echo $name; ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <div class="scgrid-6" >
                                <p>Activity:</p>
                                <input style="width:100%;" class="form_input" type="text" name="activity" value=""><br>
                            </div>
                            <div class="scgrid-6" >
                                <p>Date:</p>
                                <input style="width:100%;" class="form_input" type="date" name="date" value=""><br>
                            </div>
                            <div class="scgrid-6" >
                                <p>Time:</p>
                                <input style="width:100%;" class="form_input" type="date" name="time" value=""><br>
                            </div>
                            <div class="scgrid-6" >
                                <p>Activity Length:</p>
                                <input style="width:100%;" class="form_input" type="text" name="length" value=""><br>
                            </div>
                            <div class="scgrid-6" >
                                <p>Activity Location:</p>
                                <input style="width:100%;" class="form_input" type="text" name="location" value=""><br>
                            </div>
                            <div class="scgrid-12" >
                                <input class="pink pull_right  small button" type="submit" value="Submit">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


